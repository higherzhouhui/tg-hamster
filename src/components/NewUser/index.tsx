import { useEffect, useState } from 'react';
import './index.scss'

import { Button } from "antd-mobile";
import EventBus from '@/utils/eventBus';
import { useSelector } from 'react-redux';
import { updateUserReq } from '@/api/common';
import LogoIcon from '@/assets/logo.jpg'

export default function ({ cStep }: { cStep?: number }) {
  const eventBus = EventBus.getInstance();
  const [step, setStep] = useState(cStep || 0)
  const [isShowBtn, setIsShowBtn] = useState(true)
  const [thirdIndex, setThirdIndex] = useState(0)

  const handleNext = async () => {
    if (!isShowBtn) {
      return
    }
    if (step == 1) {
      // 这一步继续的话就算过了新人阶段
      await updateUserReq({
        is_New: false
      })
    }
    if (step == 2 && thirdIndex == 0) {
      setThirdIndex(1)
      return
    }
    const newStep = step + 1
    setStep(newStep)
    if (newStep == 3) {
      // 退出
      eventBus.emit('updateStep', 0)
    }
    if (newStep == 1) {
      setIsShowBtn(false)
      setTimeout(() => {
        setIsShowBtn(true)
      }, 6300);
    }
  }
  useEffect(() => {
    setStep(cStep || 0)
  }, [cStep])
  const list = [
    {
      btn: `Wow, let's go!`,
      comp: <First />,
    }, {
      btn: 'Continue',
      comp: <Second />,
    }, {
      btn: 'Continue',
      comp: <Third cIndex={thirdIndex} handleClick={(index: number) => setThirdIndex(index)} />,
    }
  ]
  return <div className={`new-user ${step == 2 ? 'new-bg' : ''}`}>
    {
      list[step].comp
    }
    <Button color={step !== 2 ? 'primary' : 'default'} style={{ fontWeight: 'bold', width: '100%', opacity: isShowBtn ? 1 : 0 }} onClick={() => handleNext()}>{list[step].btn}</Button>
  </div>
}


function First() {
  return <div className="first">
    <img src={LogoIcon} alt='logo' style={{ width: '70vw', objectFit: 'contain' }} />
    <p>👋 Hey!</p>
    <p>You've been in Telegram for a while,</p>
    <p>it's time to get rewarded</p>
  </div>
}


function Second() {
  const list = [
    'Account Age Verified',
    'Activity Level Analyzed',
    'Telegram Premium Checked',
    'OG Status Confirmed'
  ]
  return <div className='second'>
    <div className="title">Checking your account</div>
    <div className='list-warpper'>
      {
        list.map((item, index) => {
          return <div key={item} className={`list list-${index}`}>
            <div className='top'>
              <span>{item}</span>
              {checkIcon}
            </div>
            <div className='bot'>
              <div className='progress' />
            </div>
          </div>
        })
      }
    </div>
  </div>
}


function Third({ cIndex, handleClick }: { cIndex: number, handleClick: (index: number) => void }) {
  const userInfo = useSelector((state: any) => state.user.info);

  const staticList = [
    {
      title: `${userInfo.year < 3 ? 'Rising star!✨' : 'Foundation stone!👑'}`,
      desc: `You've joined Telegram`,
      subTitle: `${userInfo.year == 0 ? 'many days' : userInfo.year == 1 ? 'year ago' : 'years ago'}`,
      center: yearList[userInfo.year],
      rank1: `Your account number is #${userInfo.user_id}.`,
      rank2: `You're in the Top ${userInfo.percent}% Telegram users 🔥`
    },
    {
      title: 'You are amazing!',
      desc: `Here is your Hamsters reward`,
      subTitle: userInfo.score.toLocaleString(),
      center: <img src={LogoIcon} alt='logo' style={{ width: '60vw', objectFit: 'contain' }} />,
      rank1: 'Thanks for your time on Telegram 🤝',
    },
  ]
  const [list, setList] = useState(staticList)
  const [tabIndex, setTabIndex] = useState(cIndex)
  useEffect(() => {
    setTabIndex(cIndex)
  }, [cIndex])
  useEffect(() => {
    handleClick(tabIndex)
  }, [tabIndex])

  return <div className='third'>
    <div className='tab-list'>
      {
        list.map((item, index) => {
          return <div className={`tab ${tabIndex == index ? 'tab-active' : ''} ${tabIndex == 2 ? 'tab-active' : ''}`} key={item.title} onClick={() => setTabIndex(index)}></div>
        })
      }
    </div>
    <div className='title'>
      {
        list[tabIndex].title
      }
    </div>
    <div className='desc'>{list[tabIndex].desc}</div>
    <div className='center'>
      {list[tabIndex].center}
    </div>
    {/* <div className='rotate'>💫</div> */}
    <div className='sub-title'>{list[tabIndex].subTitle}</div>
    <div className='rank'>{list[tabIndex].rank1}</div>
    <div className='rank'>{list[tabIndex].rank2}</div>
  </div>
}

var checkIcon = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2984" width="18" height="18" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M511.371087 0C229.408252 0 0 229.408252 0 511.371087s229.408252 511.37915 511.371087 511.379149 511.37915-229.408252 511.379149-511.379149C1022.750236 229.408252 793.341984 0 511.371087 0z m0 971.655055c-253.806866 0-460.275906-206.469039-460.275906-460.283968 0-253.806866 206.469039-460.275906 460.275906-460.275906 253.814929 0 460.283969 206.469039 460.283968 460.275906 0 253.814929-206.469039 460.283969-460.283968 460.283968zM645.265134 386.862362L449.221543 581.865827l-71.526803-71.954142a25.616126 25.616126 0 0 0-36.08189-0.209638c-10.014236 9.804598-10.014236 26.075717-0.209637 36.08189l89.46696 90.095874a25.398425 25.398425 0 0 0 36.08189 0l214.185323-212.935559a25.616126 25.616126 0 0 0 0.209638-36.073827 25.430677 25.430677 0 0 0-36.08189 0z" p-id="2985"></path></svg>


var num1 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5075" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M721.875514 50.613231L635.921319 3.610078 300.167797 252.066458l65.809987 87.297142 237.712802-178.623125L541.909442 1012.213591l107.44135 8.057683L721.875514 50.613231z" p-id="5076" fill="#ffffff"></path></svg>

var num2 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8189" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M843.421821 902.992616H329.840909l378.656593-364.736052h1.451219c33.846898-33.913878 59.483245-71.679068 76.892294-113.345805 17.409049-41.666737 25.619601-84.282349 24.665145-127.874743a305.621193 305.621193 0 0 0-26.116364-116.990598c-16.454594-37.290753-40.142957-69.982258-71.087417-98.091258-29.013222-27.109892-62.385683-47.192534-100.106221-60.275834C576.475621 8.600608 536.807101 3.024577 495.235251 4.950233 451.709836 6.920542 410.361251 17.464209 371.189494 36.547742c-39.171757 19.111441-72.789809 44.820348-100.83183 77.143466-17.409049 19.407267-31.91566 41.1923-43.519833 65.355101-11.609754 24.185127-21.28827 47.147881-29.018803 68.910588C190.066168 269.719604 184.512464 288.579873 181.135588 304.537703c-3.399202 15.963412-5.576031 25.390755-6.530487 28.293194l113.161612 21.762707c0.954456-7.730533 3.376876-18.363505 7.256097-31.921242 3.851313-13.529829 8.707316-28.287612 14.506611-44.245442a503.070736 503.070736 0 0 1 20.311488-47.879072c7.730533-15.95783 16.437849-29.738831 26.116365-41.348586 37.720537-43.519833 86.074047-66.733759 145.077272-69.636197 53.181604-2.902439 98.655001 13.055392 136.375539 47.879072 19.334706 17.409049 34.092489 37.720537 44.251024 60.928882a179.208833 179.208833 0 0 1 15.23222 72.544218c1.925656 57.07757-20.311488 109.304718-66.739341 156.681445L176.056321 892.839662v124.765785h667.3655v-114.612831z" p-id="8190" fill="#ffffff"></path></svg>

var num3 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7149" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M529.611312 529.761055c17.716395-0.920332 36.151098-3.501752 55.287274-7.699365 19.113729-4.197613 38.249904-10.499644 57.38608-18.894869 19.113729-8.400837 38.031045-19.596342 56.751948-33.592125 31.184671-23.311341 55.988746-50.848354 74.423449-82.58298 18.412256-31.706567 28.580804-65.781305 30.483198-102.173709 2.800279-35.449625-2.182983-69.98453-14.910504-103.576655-12.749968-33.592125-32.34631-63.901358-58.811472-90.978205-26.437104-26.11162-56.925914-46.64513-91.438371-61.583693C604.253621 13.763339 567.40105 4.8855 528.213979 2.085221c-39.192683-1.8575-76.763562 2.58142-112.673353 13.299922a311.902827 311.902827 0 0 0-98.67757 49.686716c-51.330967 38.272351-83.980313 86.780592-97.976097 145.564005l107.774268 25.1969c7.458058-33.592125 26.594234-61.589304 57.38608-83.980313a189.307844 189.307844 0 0 1 65.085444-32.194792c23.793954-6.515279 47.806768-9.096698 72.083336-7.699364 24.248509 1.402945 47.806768 6.997892 70.680391 16.796063 22.851175 9.798171 42.688823 23.098094 59.484886 39.894156 30.814293 32.671793 44.810077 68.581584 41.992962 107.774267-2.800279 41.987351-23.3394 77.459423-61.589304 106.371323-17.73323 13.081063-38.491211 22.637927-62.285165 28.69304-23.793954 6.083171-53.424162 9.096698-88.873787 9.096698v110.574547c14.910504 0 31.246401-0.460166 48.985242-1.397334zM523.314893 1016.145399a156.478921 156.478921 0 0 1 14.697257-0.701472c43.84485-3.743058 84.895034-14.478397 123.167385-32.194792 38.249904-17.73323 71.381863-41.527185 99.379042-71.381863 29.849067-29.871514 51.544215-63.205497 65.079832-100.074904 13.518782-36.85257 17.957701-75.343781 13.299923-115.473632-3.743058-41.050183-15.881342-79.081228-36.392404-114.070687-20.533509-34.995071-48.530688-65.54561-83.980314-91.679678-30.791846-22.391009-66.482778-39.647238-107.072795-51.785521-40.590017-12.115837-84.22162-18.199008-130.866749-18.199008H367.251244v110.574547h113.374826c34.506846 0 66.701637 3.978753 96.573151 11.896977 29.854679 7.940671 55.506133 19.837648 76.982422 35.690931 22.396621 15.881342 40.107404 34.995071 53.188467 57.38608 13.053004 22.396621 20.511062 45.730409 22.391009 69.98453 4.657779 49.467856-11.195505 92.858152-47.587909 130.170888-19.596342 20.533509-42.93013 36.605652-69.978918 48.289382-27.076847 11.655671-54.832719 18.653562-83.284452 20.993675-28.47418 2.317666-57.16722-0.241307-86.07912-7.699364-28.934346-7.480505-55.068414-19.596342-78.379755-36.392404-23.333788-17.710783-41.532796-37.789738-54.585801-60.186359-13.081063-22.391009-20.078955-46.64513-20.993675-72.779197l-110.574547 5.594946c1.8575 41.992963 13.51317 81.662647 34.989459 118.975384 21.453841 37.307125 50.388188 69.501916 86.780592 96.573152 29.854679 21.453841 62.504025 38.008598 97.976097 49.692327 35.449625 11.655671 72.302196 17.491924 110.574547 17.491923 4.657779 0 9.556864-0.241307 14.697256-0.695861z" p-id="7150" fill="#ffffff"></path></svg>

var num4 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9235" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M725.772469 1017.735331v-208.971224h137.407111v-113.072859h-137.407111V5.800711H591.231491L156.114548 689.964557v118.79955h456.585062v208.971224h113.072859z m-439.410566-322.044083l326.337707-512.407746v512.407746H286.361903z" p-id="9236" fill="#ffffff"></path></svg>

var num5 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="10303" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M638.810715 987.940826c42.440045-18.336913 79.091543-45.359438 109.976821-81.039666 28.942738-32.805491 50.148805-70.18265 63.668441-112.148223 13.50289-41.965574 18.816966-85.125699 15.919901-129.508285-3.868335-43.416897-15.439848-83.931148-34.731285-121.553916-19.308183-37.622768-45.353856-70.411512-78.137019-98.399725-38.59962-31.839802-81.536464-52.822589-128.793787-62.948361-47.274068-10.131354-101.788008-9.880163-163.513907 0.720079l-8.685613 1.451324-50.645604 26.045673 60.776958-290.861954h351.638911V5.378145H333.480184L229.291911 493.03955l86.822631 69.46257 134.576752-69.46257c53.04587-7.70876 93.811311-6.73749 122.279577 2.897065 28.440356 9.651301 51.371266 21.702867 68.731327 36.177026 43.416897 36.673826 67.514448 83.931148 72.354053 141.811041a238.681295 238.681295 0 0 1-9.405692 84.651228 186.640188 186.640188 0 0 1-41.239912 73.079715 215.309407 215.309407 0 0 1-63.668441 48.474201c-24.12546 12.051566-49.205445 19.040246-75.251118 20.982787-26.045673 1.925794-52.091346-0.72008-78.1426-7.959951-26.045673-7.234289-49.696662-19.531464-70.90273-36.897106-22.205248-17.365643-39.3197-37.85163-51.371266-61.502619-12.073894-23.628661-19.062575-48.948672-20.982787-75.971198l-114.319627 5.788548c1.920212 43.411315 13.022836 84.182339 33.285544 122.279577 20.257125 38.097239 47.748539 71.131592 82.479825 99.125388 28.942738 23.148608 60.776958 40.514251 95.508243 52.091345 34.731285 11.577095 69.931459 17.365643 105.634014 17.365643 46.30838 0 90.668638-9.176829 133.131011-27.491414z" p-id="10304" fill="#ffffff"></path></svg>

var num6 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11369" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M623.319103 57.005688L525.432888 3.097258 228.950444 544.999796l97.880644 52.488176L623.319103 57.005688z m10.63799 934.845374c38.302333-17.020784 71.636557-40.429931 100.008242-70.216302 28.371686-29.791941 50.828426-64.791484 67.386931-104.976351 16.530656-40.184867 24.823833-82.987459 24.823833-128.385498 0-45.392469-8.293176-87.949998-24.823833-127.672586-16.558504-39.717018-39.015245-74.471498-67.386931-104.263439-28.371686-29.791941-61.70591-53.418303-100.008242-70.929214-38.302333-17.488632-79.216821-26.244088-122.710047-26.244088-43.509935 0-84.402145 8.755455-122.704478 26.244088-38.302333 17.510911-71.642127 41.137273-100.013812 70.929214-28.371686 29.791941-50.845135 64.54642-67.381361 104.263439C204.58889 600.322913 196.323562 642.880441 196.323562 688.272911c0 45.398039 8.265328 88.200631 24.823833 128.385498 16.536226 40.184867 39.009675 75.18441 67.381361 104.976351 28.371686 29.786371 61.71148 53.195518 100.013812 70.216302 38.302333 17.026353 79.194542 25.536745 122.704478 25.536745 43.493226 0 84.407714-8.510392 122.710047-25.536745z m-43.264872-503.594637a203.831681 203.831681 0 0 1 64.540851 46.812725c18.446608 19.861294 32.849667 43.042086 43.270441 69.508959 10.392926 26.489151 15.600528 54.392988 15.600528 83.694802 0 30.282068-5.207602 58.40869-15.600528 84.407714-10.420774 26.021303-24.823833 48.940322-43.270441 68.801616a203.915225 203.915225 0 0 1-64.540851 46.812725c-24.606617 11.350902-51.07349 17.020784-79.445175 17.020783-28.371686 0-54.855267-5.669881-79.439607-17.020783a203.68687 203.68687 0 0 1-64.54642-46.812725c-18.441039-19.861294-32.871945-42.780314-43.264871-68.801616-10.415205-25.999024-15.606098-54.125646-15.606098-84.407714 0-29.301814 5.190893-57.205651 15.606098-83.694802 10.392926-26.466873 24.823833-49.647665 43.264871-69.508959A203.603326 203.603326 0 0 1 431.807439 488.256425c24.584339-11.350902 51.06792-17.026353 79.439607-17.026353 28.371686 0 54.838559 5.675451 79.445175 17.026353z" p-id="11370" fill="#ffffff"></path></svg>

var num7 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12406" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M503.789896 966.710421c10.317419-31.451306 23.808566-72.463046 40.529513-123.052042a21409.182523 21409.182523 0 0 0 55.994427-172.418649 29147.622388 29147.622388 0 0 1 64.842735-199.681307 24758.945647 24758.945647 0 0 0 66.317453-204.840016 24173.656416 24173.656416 0 0 1 60.41858-187.154615L816.945989 2.934528H203.900658v116.418615h453.88793a16633.053058 16633.053058 0 0 0-60.418581 184.945341 48707.357107 48707.357107 0 0 1-61.158743 189.363888 53495.581503 53495.581503 0 0 0-57.474752 177.577358 49235.05944 49235.05944 0 0 1-48.626444 150.3147c-14.253739 43.703241-26.045875 79.068437-35.370804 106.101196-9.347357 27.01033-14.506067 42.486458-15.470521 46.422778v-1.474718l107.575914 45.682615c0.964454-2.943829 6.633427-20.147003 16.945239-51.57588z" p-id="12407" fill="#ffffff"></path></svg>

var num8 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13543" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M512 64a234.666667 234.666667 0 0 1 143.018667 420.693333c80.554667 44.8 134.314667 126.293333 134.314666 219.306667 0 141.397333-124.16 256-277.333333 256s-277.333333-114.602667-277.333333-256c0-93.056 53.802667-174.506667 134.272-219.349333A234.666667 234.666667 0 0 1 512 64z m0 469.333333c-107.52 0-192 77.994667-192 170.666667 0 92.672 84.48 170.666667 192 170.666667s192-77.994667 192-170.666667c0-92.672-84.48-170.666667-192-170.666667z m0-384a149.333333 149.333333 0 1 0 0 298.666667 149.333333 149.333333 0 0 0 0-298.666667z" p-id="13544" fill="#ffffff"></path></svg>

var num9 = <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14601" xmlnsXlink="http://www.w3.org/1999/xlink"><path d="M792.404047 429.786649l-96.253721-48.124076-295.627282 585.75276 96.253721 48.124077L792.404047 429.786649z m-166.379444 180.083836c36.652704-16.544391 68.516389-39.036077 95.563212-67.525174 27.030117-28.489097 48.575135-62.006664 64.623919-100.591682 16.032078-38.585018 24.062038-79.469879 24.062038-122.654583 0-43.184704-8.02996-83.830114-24.062038-121.947368-16.048784-38.111685-37.593802-71.412076-64.623919-99.901172-27.046822-28.489097-58.910507-50.980782-95.563212-67.525174C589.349624 13.180941 550.397077 4.911529 509.150255 4.911529c-41.25239 0-80.221644 8.269411-116.874348 24.813803-36.674979 16.544391-68.750272 39.036077-96.253722 67.525174-27.497881 28.489097-49.048469 61.789488-64.623919 99.901172C215.800541 235.268932 208.021169 275.914342 208.021169 319.099046c0 43.184704 7.779372 84.069565 23.377097 122.654583 15.57545 38.585018 37.126038 72.102585 64.623919 100.591682 27.50345 28.489097 59.578743 50.980782 96.253722 67.525174 36.652704 16.544391 75.621958 24.791528 116.874348 24.791529 41.246822 0 80.199369-8.247137 116.874348-24.791529z m-41.530822-479.831902c23.293568 10.998039 43.613488 25.671372 60.976468 43.997724 17.357411 18.348627 31.045097 40.110822 41.096469 65.314428 10.056941 25.220313 15.085411 52.033253 15.085412 80.438821 0 28.422273-5.02847 55.235213-15.085412 80.433251-10.051372 25.225881-23.739058 46.988077-41.096469 65.314429-17.36298 18.348627-37.6829 32.999685-60.976468 44.003292-23.287999 10.998039-48.185331 16.499842-74.658585 16.499843-26.512234 0-51.626743-5.501804-75.365801-16.499843-23.761332-11.003607-44.303998-25.654666-61.661409-44.003292-17.357411-18.326352-31.045097-40.088547-41.102038-65.314429-10.051372-25.198038-15.057568-52.010978-15.057568-80.433251 0-28.405567 5.006196-55.218508 15.057568-80.438821 10.056941-25.203607 23.744626-46.965802 41.102038-65.314428 17.357411-18.326352 37.900077-32.999685 61.661409-43.997724 23.739058-11.003607 48.853567-16.505411 75.365801-16.505411 26.473254 0 51.370586 5.501804 74.658585 16.505411z" p-id="14602" fill="#ffffff"></path></svg>

var yearList = ['', num1, num2, num3, num4, num5, num6, num7, num8, num9]

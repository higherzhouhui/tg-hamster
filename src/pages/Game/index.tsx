import { Popup, Toast } from 'antd-mobile';
import './index.scss'
import { useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import { initUtils } from '@telegram-apps/sdk';
import { useState } from 'react';

export default function () {
  const userInfo = useSelector((state: any) => state.user.info);
  const navigate = useNavigate()
  const link = `https://t.me/HamstersTon_bot/Hamster?startapp=${btoa(userInfo.user_id)}`;
  const [isShowInvite, setShowInvite] = useState(false)
  const utils = initUtils()

  const handlePlayGame = (link: string) => {
    if (userInfo?.ticket > 0) {
      navigate(link)
    } else {
      setShowInvite(true)
    }
  }

  const handleCopyLink = () => {
    const textToCopy = link; // æ›¿æ¢ä¸ºä½ æƒ³è¦å¤åˆ¶çš„å†…å®¹  
    const textArea = document.createElement("textarea");
    textArea.value = textToCopy;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand("copy");
    document.body.removeChild(textArea);
    Toast.show({ content: 'copied', position: 'top' })
  }

  const handleSendLink = () => {
    const text = `Hey, if you're a Pig, DOGS, Blum or Catizen user... you have something very special to claim in the Hamster app now.\nThe Hamster airdrop is coming! ðŸª‚\nClaim with this link.`
    utils.shareURL(link, text)
  }

  return <div className='gamepage-container fadeIn'>
    <div className='title'>Games</div>
    <div className='intros'>
      <div className='intro-list'>
        <img src='/assets/g1.png' />
        <div className='btn' onClick={() => handlePlayGame('/emjoyGame')}>
          <span>Play Game</span>
          <span>
            {userInfo?.ticket}
          </span>
          <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2129" width="16" height="16"><path d="M934.24704 556.56l57.296 57.304c43.488 43.488 31.64 116.648-23.392 144.16l-470.752 235.376-4.272 4.272c-35.096 35.096-92.208 35.096-127.304 0l-42.424-42.424-0.008-0.008-0.016-0.008-84.856-84.864a30.016 30.016 0 0 1 0-42.432 29.984 29.984 0 0 0 0-42.432 29.984 29.984 0 0 0-42.432 0 30.016 30.016 0 0 1-42.432 0L68.78304 700.632 26.34304 658.2c-35.096-35.096-35.096-92.208 0-127.304L530.91104 26.32c35.104-35.096 92.208-35.096 127.304 0l127.312 127.312a30 30 0 0 1 0 42.432 30.04 30.04 0 0 0 0 42.432 30.04 30.04 0 0 0 42.432 0 30 30 0 0 1 42.432 0l127.312 127.304c35.096 35.104 35.096 92.208 0 127.304l-63.456 63.456zM657.27104 365.4a30 30 0 0 1 0 42.432l-24.64 24.64c9.28 18.72 13.24 41.456 11.056 66.584a30 30 0 1 1-59.784-5.2c2.136-24.584-5.16-42.656-20.032-49.584a30.112 30.112 0 0 0-33.904 6 30.04 30.04 0 0 0 0 42.432 89.416 89.416 0 0 1 26.368 63.648c0 24.04-9.36 46.648-26.368 63.648a89.856 89.856 0 0 1-102.448 17.584l-24.856 24.856a30 30 0 1 1-42.432-42.432l24.712-24.72c-7.32-14.72-11.408-31.928-11.704-50.792a30 30 0 0 1 29.52-30.48h0.488a30 30 0 0 1 29.992 29.536c0.32 20.336 8.264 35.144 21.784 40.616 11.2 4.544 23.96 1.952 32.504-6.592a29.808 29.808 0 0 0 8.8-21.224c0-8.008-3.128-15.544-8.8-21.216-35.096-35.096-35.096-92.208 0-127.304a90.312 90.312 0 0 1 101.688-17.952c0.264 0.12 0.504 0.248 0.768 0.376l24.848-24.856a30 30 0 0 1 42.44 0z m-206.576 589.84l504.568-504.56a30.04 30.04 0 0 0 0-42.44l-21.216-21.216-63.648 63.648a30 30 0 1 1-42.44-42.432l63.656-63.648-46.048-46.048c-32.784 15.696-74.256 10.608-102.48-17.608-28.256-28.256-33.28-69.744-17.608-102.48l-46.04-46.048-63.656 63.656a30 30 0 1 1-42.432-42.432l63.648-63.656-21.216-21.216a30.04 30.04 0 0 0-42.432 0L68.78304 573.328a30.04 30.04 0 0 0 0 42.44l21.216 21.216 63.656-63.656a30 30 0 1 1 42.432 42.432l-63.656 63.656 46.04 46.04c32.784-15.696 74.264-10.608 102.48 17.616 28.24 28.24 33.304 69.712 17.616 102.48l46.04 46.04 63.656-63.656a30 30 0 1 1 42.432 42.44l-63.648 63.648 21.216 21.216a30.04 30.04 0 0 0 42.432 0z m490.624-250.88c18.328-9.176 22.296-33.56 7.792-48.064l-57.304-57.296-260.216 260.216 309.728-154.864zM785.92704 492.696a30 30 0 0 1 0 42.432L701.06304 620.008a30 30 0 1 1-42.432-42.44l84.864-84.864a30 30 0 0 1 42.432 0zM616.19104 662.44a30 30 0 0 1 0 42.44L531.31904 789.744a30 30 0 1 1-42.432-42.432l84.872-84.872a30 30 0 0 1 42.432 0zM531.31904 238.096a30 30 0 0 1 0 42.432L446.44704 365.4A30 30 0 1 1 404.02304 322.96l84.872-84.864a30 30 0 0 1 42.432 0zM361.58304 407.832a30 30 0 0 1 0 42.432l-84.872 84.88a30 30 0 1 1-42.432-42.44L319.14304 407.84a30 30 0 0 1 42.44 0z" fill="#000000" p-id="2130"></path></svg>
        </div>
      </div>
      <div className='intro-list'>
        <img src='/assets/g2.png' />
        <div className='btn' onClick={() => handlePlayGame('/downGame')}>
          <span>Play Game</span>
          <span>
            {userInfo?.ticket}
          </span>
          <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2129" width="16" height="16"><path d="M934.24704 556.56l57.296 57.304c43.488 43.488 31.64 116.648-23.392 144.16l-470.752 235.376-4.272 4.272c-35.096 35.096-92.208 35.096-127.304 0l-42.424-42.424-0.008-0.008-0.016-0.008-84.856-84.864a30.016 30.016 0 0 1 0-42.432 29.984 29.984 0 0 0 0-42.432 29.984 29.984 0 0 0-42.432 0 30.016 30.016 0 0 1-42.432 0L68.78304 700.632 26.34304 658.2c-35.096-35.096-35.096-92.208 0-127.304L530.91104 26.32c35.104-35.096 92.208-35.096 127.304 0l127.312 127.312a30 30 0 0 1 0 42.432 30.04 30.04 0 0 0 0 42.432 30.04 30.04 0 0 0 42.432 0 30 30 0 0 1 42.432 0l127.312 127.304c35.096 35.104 35.096 92.208 0 127.304l-63.456 63.456zM657.27104 365.4a30 30 0 0 1 0 42.432l-24.64 24.64c9.28 18.72 13.24 41.456 11.056 66.584a30 30 0 1 1-59.784-5.2c2.136-24.584-5.16-42.656-20.032-49.584a30.112 30.112 0 0 0-33.904 6 30.04 30.04 0 0 0 0 42.432 89.416 89.416 0 0 1 26.368 63.648c0 24.04-9.36 46.648-26.368 63.648a89.856 89.856 0 0 1-102.448 17.584l-24.856 24.856a30 30 0 1 1-42.432-42.432l24.712-24.72c-7.32-14.72-11.408-31.928-11.704-50.792a30 30 0 0 1 29.52-30.48h0.488a30 30 0 0 1 29.992 29.536c0.32 20.336 8.264 35.144 21.784 40.616 11.2 4.544 23.96 1.952 32.504-6.592a29.808 29.808 0 0 0 8.8-21.224c0-8.008-3.128-15.544-8.8-21.216-35.096-35.096-35.096-92.208 0-127.304a90.312 90.312 0 0 1 101.688-17.952c0.264 0.12 0.504 0.248 0.768 0.376l24.848-24.856a30 30 0 0 1 42.44 0z m-206.576 589.84l504.568-504.56a30.04 30.04 0 0 0 0-42.44l-21.216-21.216-63.648 63.648a30 30 0 1 1-42.44-42.432l63.656-63.648-46.048-46.048c-32.784 15.696-74.256 10.608-102.48-17.608-28.256-28.256-33.28-69.744-17.608-102.48l-46.04-46.048-63.656 63.656a30 30 0 1 1-42.432-42.432l63.648-63.656-21.216-21.216a30.04 30.04 0 0 0-42.432 0L68.78304 573.328a30.04 30.04 0 0 0 0 42.44l21.216 21.216 63.656-63.656a30 30 0 1 1 42.432 42.432l-63.656 63.656 46.04 46.04c32.784-15.696 74.264-10.608 102.48 17.616 28.24 28.24 33.304 69.712 17.616 102.48l46.04 46.04 63.656-63.656a30 30 0 1 1 42.432 42.44l-63.648 63.648 21.216 21.216a30.04 30.04 0 0 0 42.432 0z m490.624-250.88c18.328-9.176 22.296-33.56 7.792-48.064l-57.304-57.296-260.216 260.216 309.728-154.864zM785.92704 492.696a30 30 0 0 1 0 42.432L701.06304 620.008a30 30 0 1 1-42.432-42.44l84.864-84.864a30 30 0 0 1 42.432 0zM616.19104 662.44a30 30 0 0 1 0 42.44L531.31904 789.744a30 30 0 1 1-42.432-42.432l84.872-84.872a30 30 0 0 1 42.432 0zM531.31904 238.096a30 30 0 0 1 0 42.432L446.44704 365.4A30 30 0 1 1 404.02304 322.96l84.872-84.864a30 30 0 0 1 42.432 0zM361.58304 407.832a30 30 0 0 1 0 42.432l-84.872 84.88a30 30 0 1 1-42.432-42.44L319.14304 407.84a30 30 0 0 1 42.44 0z" fill="#000000" p-id="2130"></path></svg>
        </div>
      </div>
    </div>

    <Popup
      visible={isShowInvite}
      onMaskClick={() => {
        setShowInvite(false)
      }}
      bodyStyle={{
        borderTopLeftRadius: '8px',
        borderTopRightRadius: '8px',
      }}
      className='popup-invite'
    >
      <div className='popup-frens'>
        <div className='title'>
          Invite a Fren
          <svg onClick={() => setShowInvite(false)} className="close-svg" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5777" width="18" height="18"><path d="M597.795527 511.488347 813.564755 295.718095c23.833825-23.833825 23.833825-62.47489 0.001023-86.307691-23.832801-23.832801-62.47489-23.833825-86.307691 0L511.487835 425.180656 295.717583 209.410404c-23.833825-23.833825-62.475913-23.833825-86.307691 0-23.832801 23.832801-23.833825 62.47489 0 86.308715l215.769228 215.769228L209.410915 727.258599c-23.833825 23.833825-23.833825 62.47489 0 86.307691 23.832801 23.833825 62.473867 23.833825 86.307691 0l215.768205-215.768205 215.769228 215.769228c23.834848 23.833825 62.475913 23.832801 86.308715 0 23.833825-23.833825 23.833825-62.47489 0-86.307691L597.795527 511.488347z" fill="#272636" p-id="5778"></path></svg>
        </div>
        <div className='content'>
          <div className='content-desc'>
            <div>Get 2000 $Hamster and 10 ticketï¼ˆInvite a Friendï¼‰</div>
            <div>Get 20000 $Hamster and 30 ticketsï¼ˆInvite a Telegram Premiumï¼‰</div>
          </div>
          <div className='popup-content-btn' onClick={() => handleCopyLink()}>Copy link</div>
          <div className='popup-content-btn btn-send' onClick={() => handleSendLink()}>Send</div>
        </div>
      </div>
    </Popup>

  </div>
}